name: KM CICD Workflow
on:
- push:
    branches:
        - 'v[0-9]+.[0-9]'

jobs:
    CICD_Workflow:
        runs-on: ubuntu-latest

        steps:
        - name: checkout my source
          id: check_out_mysource
          uses: actions/checkout@v4
        
        - name: scan code for vulnerabilities
          id: scan_code_for_vulnerabilities
          uses: aquasecurity/trivy-action@v0.46.0
          with:
            image-ref: .
            format: table
            severity: CRITICAL, HIGH
        
        - name: Send to Slack
          id: to_slack
          uses: slackapi/slack-github-action@v1.24.0
          with: 
            slack-webhook-url: ${{ secrets.SLACK_WEBHOOK_TEST }}
            slack-body: ${{ steps.scan_code_for_vulnerabilities.outputs.scan-result }}
            slack-token: ${{ secrets.SLACK_TOKEN }}
           